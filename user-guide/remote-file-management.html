<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Remote File Management &#8212; thingsboard-edge-gateway 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=f6a572b4" />
    <script src="../_static/documentation_options.js?v=2709fde1"></script>
    <script src="../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Remote Software Update" href="remote-software-update.html" />
    <link rel="prev" title="Main Loop" href="main-loop.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">thingsboard-edge-gateway</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started/0_index.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="main-loop.html">Main Loop</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Remote File Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="remote-software-update.html">Remote Software Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="remote-procedure-calls.html">Remote Procedure Calls</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developer-guide/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">User Guide</a><ul>
      <li>Previous: <a href="main-loop.html" title="previous chapter">Main Loop</a></li>
      <li>Next: <a href="remote-software-update.html" title="next chapter">Remote Software Update</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="remote-file-management">
<h1>Remote File Management<a class="headerlink" href="#remote-file-management" title="Link to this heading">¶</a></h1>
<p>The Edge Gateway supports remote file management via ThingsBoard shared attributes. This mechanism allows configuration and system files on the gateway to be created, updated, monitored, and synchronized in a controlled and traceable way. The approach is designed to be robust against intermittent connectivity and to support both read-only mirroring and active configuration management.</p>
<p>The remote file management mechanism follows a <em>server-authoritative</em> model. ThingsBoard shared attributes define the desired state of all managed files. The Edge Gateway never propagates local file changes upstream, except for mirroring file content and reporting synchronization status.</p>
<section id="shared-attributes">
<h2>Shared Attributes<a class="headerlink" href="#shared-attributes" title="Link to this heading">¶</a></h2>
<p>Shared attributes are used to push file metadata and file content from ThingsBoard to the Edge Gateway. The central element is the <code class="docutils literal notranslate"><span class="pre">FILES</span></code> attribute, which defines which files are managed and how they should be handled. Actual file content is transferred separately using dedicated attributes.</p>
<section id="initialize-the-files-attribute">
<h3>Initialize the <code class="docutils literal notranslate"><span class="pre">FILES</span></code> Attribute<a class="headerlink" href="#initialize-the-files-attribute" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">FILES</span></code> attribute is a JSON object containing metadata entries for each managed file. Each entry defines the target path on the Edge Gateway, the encoding used for file transfer, and optional behavior flags.</p>
<p>Supported metadata fields:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">path</span></code>
Target location on the Edge Gateway filesystem. Can be absolute or relative. Locally defined environment variables such as <code class="docutils literal notranslate"><span class="pre">$DATA_PATH</span></code> are expanded at runtime.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">encoding</span></code>
Encoding used when transferring file content. Supported values are <code class="docutils literal notranslate"><span class="pre">text</span></code>, <code class="docutils literal notranslate"><span class="pre">json</span></code>, and <code class="docutils literal notranslate"><span class="pre">base64</span></code>. Base64 is recommended for files containing line breaks or special characters.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">write_version</span></code> (optional)
Monotonically increasing version number used to ensure that the latest file version is applied after temporary disconnections.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">restart_controller_on_change</span></code> (optional)
Boolean flag indicating whether the Edge Gateway controller should be restarted after a successful file update. Only the managed controller is restarted when this flag is set. The Edge Gateway process itself continues running and is not restarted.</p></li>
</ul>
<p>Example: Managing a controller configuration file and the system crontab</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;crontab&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/var/spool/cron/crontabs/root&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;encoding&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;base64&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;write_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;controller_config&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$DATA_PATH/config.json&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;encoding&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;write_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;restart_controller_on_change&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When a new entry is added to the <code class="docutils literal notranslate"><span class="pre">FILES</span></code> attribute, the Edge Gateway evaluates whether a corresponding <code class="docutils literal notranslate"><span class="pre">FILE_CONTENT_&lt;file_key&gt;</span></code> attribute exists.</p>
<ul class="simple">
<li><p>If file content is available, the file is created or updated accordingly.</p></li>
<li><p>If no file content attribute exists, the file is treated as read-only and its current content is mirrored back to ThingsBoard.</p></li>
</ul>
<p>Read-only mirroring is intended for observability and auditing of files that are not actively managed by the Edge Gateway, for example system or configuration files modified by other services.</p>
<p>In both cases, the Edge Gateway creates a client attribute named <code class="docutils literal notranslate"><span class="pre">FILE_READ_&lt;file_key&gt;</span></code> containing the latest local file content.</p>
</section>
<section id="populate-file-content-file-key-attributes">
<h3>Populate <code class="docutils literal notranslate"><span class="pre">FILE_CONTENT_&lt;file_key&gt;</span></code> Attributes<a class="headerlink" href="#populate-file-content-file-key-attributes" title="Link to this heading">¶</a></h3>
<p>File content is pushed using a dedicated shared attribute named <code class="docutils literal notranslate"><span class="pre">FILE_CONTENT_&lt;file_key&gt;</span></code>. The encoding must match the encoding defined in the corresponding <code class="docutils literal notranslate"><span class="pre">FILES</span></code> entry.</p>
<section id="use-case-create-or-update-a-controller-configuration-file">
<h4>Use case: Create or update a controller configuration file<a class="headerlink" href="#use-case-create-or-update-a-controller-configuration-file" title="Link to this heading">¶</a></h4>
<p>To manage the controller configuration, a shared attribute <code class="docutils literal notranslate"><span class="pre">FILE_CONTENT_controller_config</span></code> is created and populated with JSON-encoded configuration data.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;setting1&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;value1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;setting2&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;value2&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After applying the update, the Edge Gateway mirrors the current file content into the client attribute <code class="docutils literal notranslate"><span class="pre">FILE_READ_controller_config</span></code>.</p>
</section>
<section id="use-case-update-the-system-crontab">
<h4>Use case: Update the system crontab<a class="headerlink" href="#use-case-update-the-system-crontab" title="Link to this heading">¶</a></h4>
<p>System-level files such as the OS crontab can be managed in the same way. In this case, content is base64-encoded to preserve formatting and special characters. Here a shared attribute <code class="docutils literal notranslate"><span class="pre">FILE_CONTENT_crontab</span></code> is created with the base64-encoded content of the desired crontab file.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>U0hFTEw9L2Jpbi9iYXNoClBBVEg9L3Vzci9sb2NhbC9zYmluOi91c3IvbG9jYWwvYmluOi91c3IvbG9jYWwvYmluOi91c3Ivc2JpbjovdXNyL2Jpbjovc2JpbjovYmluCkhPTUU9L3Jvb3QKCiMgRG9ja2VyCkBkYWlseSBkb2NrZXIgc3lzdGVtIHBydW5lIC1hIC0tZm9yY2UgLS1maWx0ZXIgInVudGlsPTg3NjBoIgoKIyBEZWxldGUgb2xkIGxvZyBmaWxlcyAob2xkZXIgdGhhbiAxMDAgZGF5cykKQGRhaWx5IC91c3IvYmluL2ZpbmQgL2hvbWUvcGkvY29udHJvbGxlci9sb2dzLyAtdHlwZSBmIC1tdGltZSArMTAwIC1kZWxldGUK
</pre></div>
</div>
<p>After the update is applied, the Edge Gateway mirrors the current crontab content encoded as <code class="docutils literal notranslate"><span class="pre">base64</span></code> into the client attribute <code class="docutils literal notranslate"><span class="pre">FILE_READ_crontab</span></code>.</p>
</section>
</section>
</section>
<section id="client-attributes">
<h2>Client Attributes<a class="headerlink" href="#client-attributes" title="Link to this heading">¶</a></h2>
<p>Client attributes are used to report file content back to ThingsBoard and preserve synchronization status.</p>
<p>For each file defined in the <code class="docutils literal notranslate"><span class="pre">FILES</span></code> attribute:</p>
<ul class="simple">
<li><p>A client attribute <code class="docutils literal notranslate"><span class="pre">FILE_READ_&lt;file_key&gt;</span></code> mirrors the latest local file content.</p></li>
<li><p>A global client attribute <code class="docutils literal notranslate"><span class="pre">FILE_HASHES</span></code> is updated after file creation or modification.</p></li>
</ul>
</section>
<section id="file-hashes-and-synchronization">
<h2>File Hashes and Synchronization<a class="headerlink" href="#file-hashes-and-synchronization" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">FILE_HASHES</span></code> attribute is used to ensure consistency between ThingsBoard and the Edge Gateway.</p>
<p>The Edge Gateway periodically computes a hash for each managed local file and compares it against the corresponding entry in <code class="docutils literal notranslate"><span class="pre">FILE_HASHES</span></code>. Each entry includes both the hash and the associated <code class="docutils literal notranslate"><span class="pre">write_version</span></code>.</p>
<p>If a mismatch is detected:</p>
<ul class="simple">
<li><p>The Edge Gateway requests the latest content from <code class="docutils literal notranslate"><span class="pre">FILE_CONTENT_&lt;file_key&gt;</span></code>.</p></li>
<li><p>If the shared attribute is missing or empty, no action is taken.</p></li>
<li><p>If a managed file was modified locally, the detected hash mismatch causes the Edge Gateway to re-apply the remote file content, restoring the desired state defined in ThingsBoard.</p></li>
</ul>
<p>If a file update fails, for example due to invalid encoding, insufficient permissions, or temporary I/O errors, the Edge Gateway logs the error locally and does not update the corresponding hash entry. This allows the issue to be diagnosed and retried once corrected without leaving the system in an inconsistent state.</p>
<p>Example: <code class="docutils literal notranslate"><span class="pre">FILE_HASHES</span></code> client attribute</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;crontab&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;hash&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5eaad668b8e694ec58f0873830110d5f&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;write_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;controller_config&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;hash&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;9368caefc2b90f334671fb96e41ecbe1&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;write_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2025, Aigner Patrick, Frölich Lars.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 9.1.0</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/user-guide/remote-file-management.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>